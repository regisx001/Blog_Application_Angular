<ng-container *ngIf="chatService.state$ | async as state">
  <div
    class="chatbot-container bg-surface-700 fixed bottom-24 p-card right-6 w-full max-w-sm rounded-lg shadow-xl z-40 transform origin-bottom-right transition-all"
    [ngClass]="{
      'scale-100 opacity-100': state.isChatVisible,
      'scale-0 opacity-0': !state.isChatVisible
    }"
  >
    <app-chat-header
      title="Assistant"
      subtitle="Online"
      [isFullscreen]="false"
      (onClose)="chatService.closeChat()"
      (onMinimize)="chatService.minimizeChat()"
      (onExpand)="chatService.expandToFullscreen()"
    ></app-chat-header>

    <div #chatContainer class="chat-container px-4 py-3">
      <ng-container *ngFor="let message of state.messageHistory">
        <app-message-item
          [message]="message"
          [isFullscreen]="false"
        ></app-message-item>
      </ng-container>

      <app-typing-indicator
        *ngIf="state.isTyping"
        [isFullscreen]="false"
      ></app-typing-indicator>
    </div>

    <div class="border-t border-surface-600 px-4 py-3">
      <app-chat-input [isFullscreen]="false"></app-chat-input>
      <app-suggestion-chips
        [suggestions]="chatService.suggestionQueries"
        (onSelect)="selectSuggestion($event)"
      ></app-suggestion-chips>
    </div>
  </div>
</ng-container>
